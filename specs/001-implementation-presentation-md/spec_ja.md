# 機能仕様書: 2Dアニメーション自動コマ打ちシステム

**機能ブランチ**: `001-implementation-presentation-md`  
**作成日**: 2025-09-15  
**ステータス**: ドラフト  
**入力**: ユーザー記述: "implementation_presentation.md などを元にしつつ、README.mdで示しているソフトウェアの要件を纏めよ。"

## 実行フロー (main)
```
1. 入力からユーザー記述を解析
   → 空の場合: エラー "機能記述が提供されていません"
2. 記述から主要な概念を抽出
   → 識別: アクター、アクション、データ、制約
3. 不明瞭な点について
   → [要明確化: 具体的な質問] でマーク
4. ユーザーシナリオとテストのセクションを記入
   → 明確なユーザーフローがない場合: エラー "ユーザーシナリオを決定できません"
5. 機能要件を生成
   → 各要件はテスト可能でなければならない
   → 曖昧な要件をマーク
6. 主要エンティティを識別 (データが関わる場合)
7. レビューチェックリストを実行
   → [要明確化] がある場合: 警告 "仕様書には不確定要素があります"
   → 実装詳細が見つかった場合: エラー "技術的な詳細を削除してください"
8. 返却: 成功 (仕様書は計画フェーズの準備完了)
```

---

## ユーザーシナリオとテスト *(必須)*

### 主要なユーザーストーリー
アニメーターとして、2Dアニメーションクリップをシステムに提供したい。そうすることで、システムが自動的に動きを分析し、適切なフレームタイミング（2コマ打ち、3コマ打ち、または保持）を適用してくれる。これにより、「タメ」（予備動作/保持）と「ツメ」（インパクト/加速）が適切に表現され、専門的にタイミング調整された新しい動画ファイルが出力されることで、手作業の手間が省ける。

### 受け入れシナリオ
1. **前提**: 激しく速いアクションを含むアニメーションクリップが与えられた場合、 **実行**: システムがクリップを処理すると、 **結果**: 出力ビデオはアクションの激しい部分に2コマ打ちを使用しなければならない。
2. **前提**: ゆっくりとした意図的な動きを含むアニメーションクリップが与えられた場合、 **実行**: システムがクリップを処理すると、 **結果**: 出力ビデオはこれらのセクションに3コマ打ちを使用しなければならない。
3. **前提**: キャラクターが速いアクションの前にポーズを保持する（「タメ」）アニメーションクリップが与えられた場合、 **実行**: システムがクリップを処理すると、 **結果**: システムは劇的なポーズを維持するため、保持中にフレームをドロップしてはならない。

### エッジケース
- 検出可能なキャラクターや動きがないクリップを処理するとどうなるか？
- 可変フレームレートの入力ビデオをシステムはどのように処理するか？
- 極端に短いクリップ（例：0.5秒未満）に対する期待される動作は何か？

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは、2Dアニメーションビデオファイル（例：mp4, avi）とそのフレームレートを入力として受け入れなければならない。
- **FR-002**: システムは、フレームごとにキーポイントを検出することにより、キャラクターの動きを分析しなければならない。
- **FR-003**: システムは、正規化された変位、速度、加速度、方向変化、ポーズ変化の重み付き式に基づいて、各フレームの`MotionIntensity`スコアを計算しなければならない。
- **FR-004**: システムは、`MotionIntensity`スコアと設定可能な閾値に基づいて、各フレームの動きのレベルを3つの状態（例：HIGH, MID, LOW）のいずれかに分類しなければならない。
- **FR-005**: システムは、安定した分類を保証し、モーション状態間の急速なちらつきを防ぐため、設定可能な上限および下限を持つヒステリシスメカニズムを使用しなければならない。
- **FR-006**: システムは、HIGHモーションとして分類されたセクションに2コマ打ちを適用しなければならない。
- **FR-007**: システムは、MIDモーションとして分類されたセクションに3コマ打ちを適用しなければならない。
- **FR-008**: システムは、「タメ」（保持または予備動作）を作成するため、LOWモーションとして分類されたセクションの元のフレームを保持（フレームドロップなし）しなければならない。
- **FR-009**: システムは、「ツメ」（加速の開始）を識別し、その直前のフレームが「タメ」を強調するために保持されることを保証しなければならない。
- **FR-010**: システムは、調整されたフレームタイミングが適用された新しいビデオファイルを出力しなければならない。
- **FR-011**: システムは、分析のために、計算された`MotionIntensity`スコアの時系列データと最終的なフレーム分類（HIGH/MID/LOW）を出力しなければならない。
- **FR-012**: システムは、連続するモーション状態（例：HIGH, MID, LOW）が、不快な単一フレームのタイミング変更を防ぐために、最小期間持続することを保証しなければならない。[要明確化: デフォルトの最小期間は何か？プレゼンテーションでは0.08秒と0.1秒が言及されている。]

### 主要エンティティ *(機能にデータが含まれる場合に記載)*
- **AnimationClip**: 入力ビデオを表し、その内容、フレームレート、解像度によって特徴付けられる。
- **Frame**: AnimationClip内の特定のタイムスタンプにある単一の画像。
- **Keypoints**: フレーム上の2D座標（`x`, `y`）のセットで、キャラクターのポーズを表す。
- **MotionIntensityScore**: フレームに割り当てられた計算済みの数値（0-1）で、動きの激しさを定量化する。
- **MotionState**: MotionIntensityScoreによって決定される、フレームまたはフレームシーケンスに割り当てられた分類ラベル（HIGH, MID, LOW）。

---

## レビューと受け入れチェックリスト
*GATE: main()実行中に実行される自動チェック*

### コンテンツ品質
- [ ] 実装詳細（言語、フレームワーク、API）がない
- [ ] ユーザー価値とビジネスニーズに焦点を当てている
- [ ] 非技術的なステークホルダー向けに書かれている
- [ ] すべての必須セクションが完了している

### 要件の完全性
- [ ] [要明確化]マーカーが残っていない
- [ ] 要件はテスト可能で曖昧さがない
- [ ] 成功基準は測定可能である
- [ ] スコープが明確に区切られている
- [ ] 依存関係と仮定が特定されている

---

## 実行ステータス
*main()による処理中に更新*

- [ ] ユーザー記述が解析された
- [ ] 主要な概念が抽出された
- [ ] 曖昧さがマークされた
- [ ] ユーザーシナリオが定義された
- [ ] 要件が生成された
- [ ] エンティティが識別された
- [ ] レビューチェックリストが合格した

---
