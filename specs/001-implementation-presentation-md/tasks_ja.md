# 実装タスク

このドキュメントは、アーキテクチャと設計の決定に基づき、自動2Dアニメーションコマ打ちシステムを実装するために必要な作業をまとめたものです。

## フェーズ1: プロジェクトのセットアップとバックエンドのコア

-   [ ] **タスク 1.1: Wailsプロジェクトの初期化**: Svelteテンプレートを使用して新しいWailsプロジェクトをセットアップする。
-   [ ] **タスク 1.2: 基本的なUIレイアウトの作成**: Svelteで基本的なフロントエンドのレイアウトを作成する（動画のファイル入力、パラメータのプレースホルダー、「解析実行」ボタン）。
-   [ ] **タスク 1.3: Python環境のセットアップ**: `requirements.txt`（`opencv-python`, `tinydb`, `mediapipe`）を作成し、仮想環境をセットアップする。
-   [ ] **タスク 1.4: Pythonスクリプトのエントリーポイント実装**: `process_video.py`を作成し、コントラクトで定義されたコマンドライン引数（`--input`, `--output`, `--config`）を解析するように実装する。
-   [ ] **タスク 1.5: Pythonでの動画I/O実装**: スクリプト内で、OpenCVを使用して入力動画を開き、フレームレートを読み込み、出力用の動画ライターをセットアップするロジックを実装する。
-   [ ] **Task 1.6: Go-Pythonブリッジの実装**: Goバックエンドで、`os/exec`を使用して`process_video.py`を同期的に実行し、完了を待って出力をキャプチャする関数を作成する。

## フェーズ2: コアアルゴリズムの実装

-   [ ] **タスク 2.1: キーポイント検出**: MediaPipeをPythonスクリプトに統合し、入力動画の各フレームのキーポイントを検出する。
-   [ ] **タスク 2.2: 特徴量の計算**: 正規化変位、速度、加速度、方向変化、ポーズ変化といったコアな特徴量を計算する関数を実装する。
-   [ ] **タスク 2.3: MotionIntensityスコアの計算**: 各フレームの最終的な`MotionIntensity`スコアを計算するための重み付き合計式を実装する。
-   [ ] **タスク 2.4: ヒステリシスロジックの実装**: スコアに基づいて各フレームを`HIGH`、`MID`、`LOW`として分類するためのヒステリシス状態マシンを実装する。

## フェーズ3: 出力生成とデータ永続化

-   [ ] **タスク 3.1: コマ打ちロジックの実装**: Pythonの動画書き込みループを修正し、各フレームの分類に基づいて正しいコマ打ち（2コマ、3コマ、保持）を適用するようにする。
-   [ ] **タスク 3.2: TinyDBデータベースのセットアップ**: PythonでTinyDBデータベースファイルを初期化する関数を実装する。
-   [ ] **タスク 3.3: データの永続化**: 処理後、定義されたデータモデルに従って結果（動画パス、パラメータ、フレームごとの分析）をTinyDBデータベースに保存する。
-   [ ] **タスク 3.4: 成功時の出力返却**: Pythonスクリプトが正常に完了した際に、`stdout`に正しいJSON構造を返すようにする。

## フェーズ4: UI統合と最終化

-   [ ] **タスク 4.1: UIパラメータ制御の実装**: 解析パラメータを調整するためのフロントエンドコントロール（スライダー、入力フィールドなど）を実装する。
-   [ ] **タスク 4.2: ローディング画面の実装**: Svelte UIに、GoバックエンドがPythonスクリプトの終了を待っている間に表示されるモーダルローディング画面を実装する。
-   [ ] **タスク 4.3: 結果の表示**: ユーザーに結果（出力動画ファイルへのリンク、主要な分析データなど）を表示するUIコンポーネントを実装する。
-   [ ] **タスク 4.4: エラーハンドリング**: GoバックエンドとSvelteフロントエンドの両方で、Pythonスクリプトから報告されたエラーを適切に管理し表示するエラーハンドリングを実装する。
-   [ ] **タ.スク 4.5: ビルドとパッケージ化**: 最終的なビルドスクリプトを作成し、`wails build`でアプリケーションが配布可能なバイナリにパッケージ化できることを確認する。
